{
id: "save_statue",
dies_on_inactive: false,
zorder: "@include data/zorder.cfg:exterior_decor",
editor_info: {
	category: "props",
},

properties: {
	activate:  "commands :: [
					set(_last_triggered,cycle),
					set(particle_systems['fire_bits'].spawn_rate, 750),
				    save_game(),
				    checkpoint_game(),
					title(~The game has been saved.~),

					map(filter(level.chars, value is obj save_statue and value != me), value.deactivate)
				]",
				
	deactivate: "commands :: [
					set(particle_systems['fire_bits'].spawn_rate, 0)
				]",

	is_player_within_bounds:  "bool :: (level.player.mid_x > _x_bound and level.player.mid_x <_x2_bound and level.player.mid_y > _y_bound and level.player.mid_y < _y2_bound and level.player.hitpoints > 0)",
	has_not_triggered_recently: "bool :: (cycle - _last_triggered > 250)",

#-------------------------- vars --------------------------#
	_x_bound: { type: "int", editor_info: { type: "x", value: "mid_x-50" } },
	_x2_bound: { type: "int", editor_info: { type: "x", value: "mid_x+50" } },
	_y_bound: { type: "int", editor_info: { type: "y", value: "mid_y-200" } },
	_y2_bound: { type: "int", editor_info: { type: "y", value: "mid_y+100" } },

	_last_triggered: { type: "int", default: -400, persistent: false },
},

on_create: "[add_particles('fire_bits')]",
on_process: "if(is_player_within_bounds and has_not_triggered_recently, activate)",

animation: [
	{
		"@base": true,
		image: "props/save_statue.png",
		pad: 3,
		palettes: "@include data/palettes.cfg:seaside_palettes + forest_palettes + cave_palettes",
	},
	{
		id: "normal",
		rect: [1,1,30,30],
		frames: 1,
		duration: -1,
	},
],


particle_system: {
	id: "fire_bits",
	type: "simple",
	spawn_rate: 0,
	time_to_live: 32,
	min_x: 14,
	max_x: 18,
	min_y: 2,
	max_y: 4,
	velocity_y: -1300,
	velocity_x: -100,
	velocity_x_random: 200,
	velocity_y_random: 600,
	accel_y: -2,
	animation: {
		id: "sparkle",
		image: "props/save_statue.png",
		rect: [33,1,46,14],
		frames: 8,
		frames_per_row: 4,
		duration: 4,
		pad: 3,
		palettes: "@include data/palettes.cfg:seaside_palettes + forest_palettes + cave_palettes",
	},
},
}