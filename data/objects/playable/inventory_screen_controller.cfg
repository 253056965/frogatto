{
	id: "inventory_screen_controller",
	ignore_collide: true,
	zorder: "@include data/zorder.cfg:in_front_of_everything",
	is_human: true,

	editor_info: {
		category: "player",
	},
	properties: {
		level_width: "level.dimensions[2]",
		level_height: "level.dimensions[3]",
		the_player: "level.suspended_level.player",
		
		get_ability_index: "def(name) filter( ( map(ability_list, if(value = name, index) )),value != null )[0]",
		
		ability_list: "the_player.ability_list",
		ability_buttons: "def([string] abilities) -> [widget]
						([] + 
						if('tongue' in abilities, add_ability_button('tongue',[2,2,22,22]) ) + 
						if('energyshot' in abilities, add_ability_button('energyshot',[24,2,43,22]) ) +
						if('firebreath' in abilities, add_ability_button('firebreath',[45,2,64,22]) ) +
						if('homingshot' in abilities, add_ability_button('homingshot',[66,2,85,22]) ) +
						if('acidbreath' in abilities, add_ability_button('acidbreath',[87,2,106,22]) )
						
						
						) where add_ability_button = def(string name, rect) [widget(me,
							{
								type: 'button',
								label: {
									type: 'image',
									image: 'gui/hud2.png',
									area: rect,
								},
								style: 'normal',
								resolution: 'double',
								wh: [58, 58],
								on_click: def() set(the_player.vars.current_ability, get_ability_index(name)),
							}) ]
						
						 ",
		

		make_inventory_screen: "def(abilities) ->widget widget(me, {
			type: 'dialog',
			id: 'selection_dlg',
			//rect: [2*level_width/3, 0, level_width/3, 2*level_height/3],
			rect: [20, 20, 760, 560],
			background_alpha: 255,
			background_frame: 'empty_window',
			upscale_frame: true,
			cursor: [20, 20],
			children: [{
				type: 'grid',
				columns: 4,
				children: abilities
			},
			{
				type: 'grid',
				columns: 1,
				children: [ {
					// Exit button
					type: 'button',
					label: {
						font: 'default',
						size: 2,
						type: 'graphical_font_label',
						text: ~Exit~,
					},
					resolution: 'double',
					wh: [100, 60],
					on_click: def() [fire_event('return_to_game')]
				}]
			}],
		})",
		
		draw_interface: "def() ->commands set(me.widgets, [make_inventory_screen( ability_buttons(ability_list) )])",
		
	},
	
	
	on_return_to_game: "resume_level()",
	
	on_create: "[	set(x, 0), set(y, 0),
					draw_interface(),
					]",
	
		
	animation: {
		id: "normal",
		image: "effects/particles.png",
		x: 23, y: 197, w: 1, h: 1,
		duration: -1,
	},
}