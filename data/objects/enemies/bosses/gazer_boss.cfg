{
id: "gazer_boss",
prototype: ["hittable"],
always_active: true,
editor_info: {
	category: "boss",
},

properties: {
	attack_damage:  "if(true, kill_anything, 0)",
	team:  			"if(true, 'evil', 'evil_harmless')",
	
	title: "~Gazer Boss~",
	description: "~When you stare into The Great Eye, it also stares into you!  And fires death beams at you, because eyes totally do that sometimes.  Honest.~",
	taste: "~AHA!~",


	set_behavior: "def(string choice) -> commands execute(me, [switch(choice,
					'attack_laser', begin_laser,
		), set(me.behavior, choice)])",
		
	begin_laser: "commands :: [spawn('gazer_boss.beam', mid_x, mid_y, {parent: me})]",
	
	custom_damage_table: "{
		neutral: 1.0,
		fire: 1.0,
		energy: 0.5,
		arcane: 0.25,
		acid: 0.0,
		impact: 0.0,
		impale: 1.0,
		lacerate: 1.0
	}",
	
	
							
								
#--------------------------  vars --------------------------#
	behavior: { type: "string", default: "", persistent: false },
},
		
on_create:  "set_behavior('attack_laser')",

on_process: "add(rotate, 1)",

animation: [
{
	"@base": true,
	image: "enemies/gazer-boss1.png",
	attack_area: "all",
	body_area: "all",
	no_remove_alpha_borders: true,
},
{
	id: "normal",
	rect: [1,1,125,125],
	frames:1,
	duration: 10,
},
],

object_type: [
	{
		id: "beam",
		always_active: true,
		serializable: false,
		zorder: 20,
		
		properties: {
			texture_offset: "0",
			beam_length: "800",
			
			draw_w: "img_w/2",
			pupil_offset: "64.0",
			width_coefficient: "img_w/pupil_offset * (decimal(0.5*img_h)/img_w)", //<- this is some black magic, here.   
			
			beam_angle: "parent.rotate - (90 - 1) asserting parent != null",

			offset: "{ x: decimal, y: decimal } :: { x: length * cos(beam_angle),
													 y: length * sin(beam_angle) - (beam_length - (width_coefficient) * pupil_offset)} where length = (pupil_offset + beam_length)", 

			update_attache: "[
								set(_the_attache.beam_angle, beam_angle),
								set(_the_attache.beam_distance, beam_length + pupil_offset)
							]",

			_the_attache: { type: "obj damage_beam_attache", init: "object('damage_beam_attache', mid_x, mid_y, {parent: parent, relative_x: 0, relative_y: 0})" },
		},
		
		on_create: "[add_object(_the_attache), set(_the_attache.mid_x, parent.mid_x), set(_the_attache.mid_y, parent.mid_y)] asserting parent != null",
		
		on_process: "[
						update_attache,
						//debug(decimal(0.5*img_h)/img_w),
						//debug(draw_w/decimal(img_h)),
						set(relative_x, offset.x),
						set(relative_y, offset.y),
						set(rotate, parent.rotate),
						set(draw_area, [0, texture_offset, draw_w, beam_length])
		
					] asserting parent != null",
		
		animation: [{
			id: "normal",
			image: "enemies/gazer-boss-beam.png",
			rect: [0,0,31,63],
			frames:1,
			duration: 10,
			no_remove_alpha_borders: true,
		}],

	}
],

}