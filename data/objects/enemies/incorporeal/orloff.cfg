{
id: "orloff",
prototype: ["stationary_vulnerable"],
is_strict: true,
zsub_order: -10,
has_feet: false,
hitpoints:300,
solid_area: null,

vars:{
	triggered: false,
},

//Behavior: Looks like any other diamond insertion in the alteborea pillar, but when approached, the Orloff appears and fires a moderately slow moving, semi-smart projectile (fired at the player but not homing) at the player.
properties: {
	_x_bound: { type: "int", editor_info: { type: "x", value: "x-125" } },
	_x2_bound: { type: "int", editor_info: { type: "x", value: "x+150" } },
	_y_bound: { type: "int", editor_info: { type: "y", value: "y-150" } },
	_y2_bound: { type: "int", editor_info: { type: "y", value: "y+150" } },

	last_triggered: { type: "int", init: "-400"},
	taxonomy: "'spectral'",
	handle_knockback: "def(obj hittable collide_with) -> commands null",
	points_value: 7,
	normal_repeat: "if(higher_difficulty, 0, 2)",
	attack_damage: "if(higher_difficulty,2,1)",
	
	title: "~Orloff~",
	description: "~Although it looks shiny and valuable, these cursed gemstones are just fine where they are, thank you very much. Territorial and gaudy.~",
	taste: "~Probably like an old rock. Definitely wouldn't eat it.~",

	_anim_repeat: { type: "int", default: 0, persistent: false },
},

on_create: "set(animation, 'waiting')",
on_end_waiting_anim: "[
		if(not vars.triggered, 
			set(animation, 'waiting')), 
		if(vars.triggered, 
			set(animation, 'disturbed'))
			]",
on_end_disturbed_anim: "set(animation,'spawn1')",
on_end_spawn1_anim: "set(animation, 'spawn2')",
on_end_spawn2_anim: "set(animation, 'idle')",
on_end_idle_anim: "set(animation, 'idle')", 
on_end_chargeup_anim: "animation('shoot')",
on_end_shoot_anim: "animation('normal')",
on_end_death_anim: "die()",

on_process: "[ 
	if(not vars.triggered and  level.player.midpoint_x > _x_bound and level.player.midpoint_x < _x2_bound  and level.player.midpoint_y > _y_bound and level.player.midpoint_y < _y2_bound and cycle - last_triggered > 250, 
		[fire_event('triggered'),set(last_triggered,cycle)]
		),
	if(self.hitpoints = 0, [set(animation,'death'), debug('orloff died')]),
]",

on_triggered: "[
	debug('orloff triggered'),
	set(vars.triggered, true),
]",

	
editor_info: {
	category: "enemies, forest",
},
animation: [
	{
		"@base": true,
		no_remove_alpha_borders: true,
		image: "enemies/orloff.png",
		pad: 2,
		accel_y: 0,
		body_area: "all",
		attack_area: "all",
	},
		{
		id: "waiting",
		frames: 1,
		duration: 1,
		rect: [1,1,14,14],
	},
	{
		id: "disturbed",
		frames: 9,
		frames_per_row: 1,
		duration: 2,
		reverse: true,
		rect: [79,17,64,30],
	},
	{
		id: "spawn1",
		duration: 9,
		frames: 4,
		frames_per_row: 1,
		rect: [1,1,14,14],
	},
	{
		id: "spawn2",
		duration: 4,
		frames: 6,
		frames_per_row: 1,
		rect: [1,65,14,78],
	},
	{
		id: "idle",
		frames: 10,
		frames_per_row:1,
		duration: 7,
		reverse: true,
		rect: [16,1,31,14],
	},
	{
		id: "chargeup",
		rect: [47,1,32,14],
		frames: 4,
		frames_per_row: 1,
		duration: 3,
	},
	{
		id: "shoot",
		rect: [79,1,64,14],
		frames: 1,
		frames_per_row: 1,
		duration: 1,
	},
	{
		id: "death",
		duration: 8,
		frames: 10,
		frames_per_row: 1,
		rect: [48,1,63,14],
	},
],

}
