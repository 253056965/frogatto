{
id: "snodge_red",
prototype: ["ant"],
editor_info: {
	category: "enemies, seaside",
},
properties: {
	points_value: 4,
	player_within_aggro_range: "lib.math.length(level.player, me) < 300",
	
	consider_attacking_player: "commands :: if(	(level.cycle - last_checked_for_player > 150) and is_standing,
										[liftoff, set(last_checked_for_player,level.cycle)] )",

	liftoff: "commands :: [
				remove_object(me),
				add_object(flying_version),
				fire_event(flying_version, 'liftoff')
			] where flying_version = object('snodge_red.flying',mid_x,mid_y,{facing: facing, hitpoints: hitpoints})",
	
	last_checked_for_player: { type:"int", default: 0 },
	last_finished_attacking_player: { type:"int", default: 0 },
		
},
on_end_anim: "proto_event('ant','end_anim')",

on_distress: "sound_falloff('snodge-struggle.wav')",

on_process: "consider_attacking_player",

on_snodging: "sound_falloff('snodge.wav')",

animation: ["@flatten",

	{
		"@base": true,
		image: "enemies/snodge-red.png",
		rotate_on_slope: true,
		pad: 3,
		accel_x: 0,
		accel_y: 80,
		body_area: "all",
	},
	{
		id: "stand",
		rect: [123,45,147,72],
		frames: 1,
		duration: 6,
		attack_area: [15,14,30,30],
	},
	{
		id: "walk",
		attack_area: [15,14,30,30],
		accel_x: 250,
		rect: [177,1,201,28],
		events: "1:snodging",
		frames: 7,
		frames_per_row: 1,
		duration: 3,
	},
	{
		id: "spring",
		rect: [3,13,27,40],
		frames: 1,
		duration: 4,
	},
	{
		id: "turn",
		rect: [3,45,27,72],
		frames: 3,
		duration: 4,
		attack_area: [0,14,30,30],
	},
	{
		id: "hurt",
		rect: [90,45,114,72],
		frames: 1,
		duration: 18,
	},
	
],
object_type: [
{
	id: "flying",
	prototype: ["ant_flying"],
	//on_bounced_on: "animation('spring')",
	properties: {
		thrown_type: "'snodge_red.thrown'",
	
		unit_triangle_xy_components_for_angle: "def(decimal angle) -> {x: decimal, y: decimal} {x: cos(angle), y: sin(angle)}",
		angle_components_to_player: "{x: decimal, y: decimal} :: unit_triangle_xy_components_for_angle( lib.math.angle(me, level.player) )",
	
		begin_charge: "[set(velocity_x, speed * ang.x), set(velocity_y, speed * ang.y)] where ang = angle_components_to_player where speed = 2500",

		liftoff: "[
				sound('snodge-growl.wav'),
				set(animation,'fly'),
				set(velocity_y, -20),
				turn_towards_player,
				set(fall_through_platforms,-1),
				schedule(50, bind_command(def() begin_charge))
				]",

		switch_to_thrown_version:  "[
										remove_object(me),
										add_object( thrown_version(me) )
									]",

		thrown_version: "def(obj hittable source_obj) -> obj throwable throwable_obj
				where throwable_obj = (obj throwable <- object(source_obj.thrown_type, source_obj.mid_x, source_obj.mid_y, {facing: source_obj.facing, hitpoints: source_obj.hitpoints, attributes:source_obj.attributes, variations: source_obj.variations, event_handlers:source_obj.event_handlers}))",
	},
	on_liftoff: "liftoff",
	on_process_fly: "/*don't do any of the normal movement mechanics.*/",


	on_collide_head: "switch_to_thrown_version",
	on_collide_feet: "switch_to_thrown_version",
	on_collide_side: "switch_to_thrown_version",

	animation: [
		{
			"@base": true,
			image: "enemies/snodge-red.png",
			rotate_on_slope: true,
			pad: 3,
			accel_x: 0,
			accel_y: 0,
			body_area: "all",
		},
		{
			id: "fly",
			duplicates: 6,
			rect: [3,76,38,111],
			frames: 8,
			frames_per_row: 4,
			duration: 2,
			events: "8:wingflap",
		},
		{
			id: "turn",
			rect: [3,154,38,185],
			frames: 3,
			duration: 4,
		},
		{
			id: "hurt",
			rect: [120,193,114,72],
			frames: 1,
			duration: 18,
		},
	],
},
{
	id: "thrown",
	prototype: ["throwable_small_enemy"],
	animation: [
		{
			image: "enemies/snodge-red.png",
			id: "thrown",
			thrown_area: "all",
			duration: 60,
			rect: [31,13,55,40],
			frames: 1,
			body_area: null,
		},
		{
			image: "enemies/snodge-red.png",
			id: "on_back",
			rect: [31,13,55,40],
			events: "10:distress",
			frames: 2,
			duration: 5,
			body_area: "all",
		},
	],
}
],
}