{
id: "homing_bug",
prototype: ["ant"],
editor_info: {
	category: "enemies, seaside",
},
properties: {
	points_value: 4,
	player_within_aggro_range: "lib.math.length(level.player, me) < 300",
	
	inside_attack_sequence: "(animation in ['fly'] and (level.cycle - last_started_attacking_player < 300))",
	consider_attacking_player: "if(	(level.cycle - last_checked_for_player > 50) and
									(level.cycle - last_started_attacking_player > 600) and
									(not inside_attack_sequence) and
									is_standing,
										[liftoff, set(last_checked_for_player,level.cycle)] )",
	
	liftoff: "[
				set(animation,'fly'),
				set(velocity_y, -100),
				turn_towards_player,
				set(fall_through_platforms,-1),
				set(last_started_attacking_player, level.cycle),
				schedule(50, begin_charge)
				]",
	
	

	unit_triangle_xy_components_for_angle: "def(decimal angle) -> {x: decimal, y: decimal} {x: cos(angle), y: sin(angle)}",
	angle_components_to_player: "{x: decimal, y: decimal} :: unit_triangle_xy_components_for_angle( lib.math.angle(me, level.player) )",
	
	begin_charge: "[set(velocity_x, speed * ang.x), set(velocity_y, speed * ang.y)] where ang = angle_components_to_player where speed = 2500",
	
	last_checked_for_player: { type:"int", default: 0 },
	last_started_attacking_player: { type:"int", default: 0 },
		
},
on_end_anim: "if(inside_attack_sequence, animation(animation), proto_event('ant','end_anim'))",

on_process: "[consider_attacking_player, if(not inside_attack_sequence, set(fall_through_platforms,0))]",

animation: ["@flatten",

	{
		"@base": true,
		image: "enemies/ant-flying-black.png",
		rotate_on_slope: true,
		pad: 3,
		accel_x: 0,
		accel_y: 80,
		body_area: "all",
		
	},
	{
		id: "stand",
		rect: [149,1,173,28],
		frames: 1,
		duration: 6,
		attack_area: [15,14,30,30],
	},
	{
		id: "walk",
		#blink variant
		attack_area: [15,14,30,30],
		accel_x: 250,
		rect: [177,1,201,28],
		frames: 7,
		frames_per_row: 1,
		duration: 3,
	},
	{
		id: "walk",
		attack_area: [15,14,30,30],
		duplicates: 6,
		accel_x: 250,
		rect: [149,1,173,28],
		frames: 7,
		frames_per_row: 1,
		duration: 3,
	},
	{
		id: "spring",
		rect: [3,33,27,60],
		frames: 1,
		duration: 4,
	},
	{
		id: "turn",
		rect: [3,65,27,92],
		frames: 3,
		duration: 4,
		attack_area: [0,14,30,30],
	},
	{
		id: "hurt",
		rect: [90,65,114,92],
		frames: 1,
		duration: 18,
	},
	
	{
		accel_y: 0,
		id: "fly",
		duplicates: 6,
		rect: [3,96,27,123],
		frames: 4,
		reverse: true,
		duration: 6,
		events: "18:wingflap",
	},
	
	//"@include data/objects/enemies/bugs/ant_anims.fson",
],
object_type: {
	id: "thrown",
	prototype: ["throwable_small_enemy"],
	animation: [
		{
			image: "enemies/ant-flying-black.png",
			id: "thrown",
			thrown_area: "all",
			duration: 60,
			rect: [31,33,55,60],
			frames: 1,
			body_area: null,
		},
		{
			image: "enemies/ant-flying-black.png",
			id: "on_back",
			rect: [31,33,55,60],
			frames: 2,
			duration: 5,
			body_area: "all",
		},
	],
},
}